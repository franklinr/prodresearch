s = c("dog","cat",NA,"cats")
is.na(s)
str_detect(s,"cat")
str_detect(s,"cat$")
s %in% c(NA)
require(stringr)
s = c("dog","cat",NA,"cats")
is.na(s)
str_detect(s,"cat")
str_detect(s,"cat$")
s %in% c(NA)
s = c("dog","cat",NA,"cats")
is.na(s)
str_detect(s,"cat")
str_detect(s,"cat$")
s %in% c("NA")
str_detect(s,"NA")
s %in% c("NA")
setwd("~/Local/Rref/works3")
require(bib2df)
require(stringr)
lines = readLines("works3.bib")
bibdf = bib2df("works3.bib")
bibdf$EXTRA = ""
for (i in 1:length(bibdf$FILE)){
frow = bibdf$FILE[i]
authors = str_split_fixed(bibdf$AUTHOR[[i]],",",2)[,1]
year =  bibdf$YEAR[i]
#  print(i)
ff = str_split(frow,";")[[1]]
for (f in ff){
if (!is.na(f) && str_detect(f,".pdf$")){
print(f)
authors = str_replace_all(authors,"[}]","")
newfile = authors[1]
if (length(authors) > 4){
newfile = paste(newfile,"_etal",sep="")
}else{
if (length(authors) > 1)
newfile = paste(newfile,authors[2],sep="_")
if (length(authors) > 2)
newfile = paste(newfile,authors[3],sep="_")
if (length(authors) > 3)
newfile = paste(newfile,authors[4],sep="_")
}
newfile = paste("https://github.com/franklinr/prodresearch/raw/master/refpdfs/",newfile,year,".pdf",sep="")
print(newfile)
file.copy(f,newfile)
bkey = bibdf$BIBTEXKEY[i]
refstart = which(str_detect(lines,bkey))
fileline = refstart+1
while(!str_detect(lines[fileline]," file = ")){
fileline = fileline + 1
}
print(lines[fileline])
lines[fileline] = paste("  url = {",newfile,"},",sep="")
#      bibdf$EXTRA[i] = newfile
}
}
}
#https://github.com/franklinr/prodresearch/raw/master/refpdfs/Abbot-Smith_etal2017.pdf
#df2bib(bibdf,"works3a.bib")
writeLines(lines,"works3b.bib")
bibdf$BIBTEXKEY[2]
bibdf = bib2df("works3.bib")
bibdf$EXTRA = ""
for (i in 1:length(bibdf$FILE)){
frow = bibdf$FILE[i]
authors = str_split_fixed(bibdf$AUTHOR[[i]],",",2)[,1]
year =  bibdf$YEAR[i]
#  print(i)
ff = str_split(frow,";")[[1]]
for (f in ff){
if (!is.na(f) && str_detect(f,".pdf$")){
print(f)
authors = str_replace_all(authors,"[}]","")
newfile = authors[1]
if (length(authors) > 4){
newfile = paste(newfile,"_etal",sep="")
}else{
if (length(authors) > 1)
newfile = paste(newfile,authors[2],sep="_")
if (length(authors) > 2)
newfile = paste(newfile,authors[3],sep="_")
if (length(authors) > 3)
newfile = paste(newfile,authors[4],sep="_")
}
newfile = paste("https://github.com/franklinr/prodresearch/raw/master/refpdfs/",newfile,year,".pdf",sep="")
print(newfile)
file.copy(f,newfile)
bkey = bibdf$BIBTEXKEY[i]
refstart = which(str_detect(lines,bkey))
print(paste(bkey,"->"lines[refstart]))
fileline = refstart+1
while(!str_detect(lines[fileline]," file = ")){
fileline = fileline + 1
}
if (fileline != refstart+1 && fileline < refstart+12 ){
lines[fileline] = paste("  url = {",newfile,"},",sep="")
print(lines[fileline])
}
#      bibdf$EXTRA[i] = newfile
}
}
}
setwd("~/Local/Rref/works3")
require(bib2df)
require(stringr)
lines = readLines("works3.bib")
bibdf = bib2df("works3.bib")
bibdf$EXTRA = ""
for (i in 1:length(bibdf$FILE)){
frow = bibdf$FILE[i]
authors = str_split_fixed(bibdf$AUTHOR[[i]],",",2)[,1]
year =  bibdf$YEAR[i]
#  print(i)
ff = str_split(frow,";")[[1]]
for (f in ff){
if (!is.na(f) && str_detect(f,".pdf$")){
print(f)
authors = str_replace_all(authors,"[}]","")
newfile = authors[1]
if (length(authors) > 4){
newfile = paste(newfile,"_etal",sep="")
}else{
if (length(authors) > 1)
newfile = paste(newfile,authors[2],sep="_")
if (length(authors) > 2)
newfile = paste(newfile,authors[3],sep="_")
if (length(authors) > 3)
newfile = paste(newfile,authors[4],sep="_")
}
newfile = paste("https://github.com/franklinr/prodresearch/raw/master/refpdfs/",newfile,year,".pdf",sep="")
print(newfile)
file.copy(f,newfile)
bkey = bibdf$BIBTEXKEY[i]
refstart = which(str_detect(lines,bkey))
print(paste(bkey,"->"lines[refstart]))
fileline = refstart+1
while(!str_detect(lines[fileline]," file = ")){
fileline = fileline + 1
}
if (fileline != refstart+1 && fileline < refstart+12 ){
lines[fileline] = paste("  url = {",newfile,"},",sep="")
print(lines[fileline])
}
}
}
}
setwd("~/Local/Rref/works3")
require(bib2df)
require(stringr)
lines = readLines("works3.bib")
bibdf = bib2df("works3.bib")
bibdf$EXTRA = ""
for (i in 1:length(bibdf$FILE)){
frow = bibdf$FILE[i]
authors = str_split_fixed(bibdf$AUTHOR[[i]],",",2)[,1]
year =  bibdf$YEAR[i]
#  print(i)
ff = str_split(frow,";")[[1]]
for (f in ff){
if (!is.na(f) && str_detect(f,".pdf$")){
print(f)
authors = str_replace_all(authors,"[}]","")
newfile = authors[1]
if (length(authors) > 4){
newfile = paste(newfile,"_etal",sep="")
}else{
if (length(authors) > 1)
newfile = paste(newfile,authors[2],sep="_")
if (length(authors) > 2)
newfile = paste(newfile,authors[3],sep="_")
if (length(authors) > 3)
newfile = paste(newfile,authors[4],sep="_")
}
newfile = paste("https://github.com/franklinr/prodresearch/raw/master/refpdfs/",newfile,year,".pdf",sep="")
print(newfile)
file.copy(f,newfile)
bkey = bibdf$BIBTEXKEY[i]
refstart = which(str_detect(lines,bkey))
print(paste(bkey,"->",lines[refstart]))
fileline = refstart+1
while(!str_detect(lines[fileline]," file = ")){
fileline = fileline + 1
}
if (fileline != refstart+1 && fileline < refstart+12 ){
lines[fileline] = paste("  url = {",newfile,"},",sep="")
print(lines[fileline])
}
}
}
}
setwd("~/Local/Rref/works3")
require(bib2df)
require(stringr)
lines = readLines("works3.bib")
bibdf = bib2df("works3.bib")
bibdf$EXTRA = ""
for (i in 1:length(bibdf$FILE)){
frow = bibdf$FILE[i]
authors = str_split_fixed(bibdf$AUTHOR[[i]],",",2)[,1]
year =  bibdf$YEAR[i]
#  print(i)
ff = str_split(frow,";")[[1]]
for (f in ff){
if (!is.na(f) && str_detect(f,".pdf$")){
print(f)
authors = str_replace_all(authors,"[}]","")
newfile = authors[1]
if (length(authors) > 4){
newfile = paste(newfile,"_etal",sep="")
}else{
if (length(authors) > 1)
newfile = paste(newfile,authors[2],sep="_")
if (length(authors) > 2)
newfile = paste(newfile,authors[3],sep="_")
if (length(authors) > 3)
newfile = paste(newfile,authors[4],sep="_")
}
newfile = paste("https://github.com/franklinr/prodresearch/raw/master/refpdfs/",newfile,year,".pdf",sep="")
print(newfile)
file.copy(f,newfile)
bkey = bibdf$BIBTEXKEY[i]
refstart = which(str_detect(lines,bkey))
print(paste(bkey,"->",lines[refstart]))
fileline = refstart+1
while(!str_detect(lines[fileline]," file = ")){
fileline = fileline + 1
}
if (str_detect(lines[refstart],bkey) && fileline != refstart+1 && fileline < refstart+12 ){
lines[fileline] = paste("  url = {",newfile,"},",sep="")
print(lines[fileline])
}
}
}
}
#https://github.com/franklinr/prodresearch/raw/master/refpdfs/Abbot-Smith_etal2017.pdf
#df2bib(bibdf,"works3a.bib")
writeLines(lines,"works3b.bib")
setwd("~/Local/Rref/works3")
require(bib2df)
require(stringr)
lines = readLines("works3.bib")
bibdf = bib2df("works3.bib")
bibdf$EXTRA = ""
for (i in 1:length(bibdf$FILE)){
frow = bibdf$FILE[i]
authors = str_split_fixed(bibdf$AUTHOR[[i]],",",2)[,1]
year =  bibdf$YEAR[i]
#  print(i)
ff = str_split(frow,";")[[1]]
for (f in ff){
if (!is.na(f) && str_detect(f,".pdf$")){
print(f)
authors = str_replace_all(authors,"[}]","")
newfile = authors[1]
if (length(authors) > 4){
newfile = paste(newfile,"_etal",sep="")
}else{
if (length(authors) > 1)
newfile = paste(newfile,authors[2],sep="_")
if (length(authors) > 2)
newfile = paste(newfile,authors[3],sep="_")
if (length(authors) > 3)
newfile = paste(newfile,authors[4],sep="_")
}
newfile = paste("https://github.com/franklinr/prodresearch/raw/master/refpdfs/",newfile,year,".pdf",sep="")
print(newfile)
file.copy(f,newfile)
bkey = bibdf$BIBTEXKEY[i]
refstart = which(str_detect(lines,bkey))
print(paste(bkey,"->",lines[refstart]))
fileline = refstart+1
while(!str_detect(lines[fileline]," file = ")){
fileline = fileline + 1
}
if (str_detect(lines[refstart],bkey) && fileline < refstart+20){
lines[fileline] = paste("  url = {",newfile,"},",sep="")
print(lines[fileline])
}
}
}
}
#df2bib(bibdf,"works3a.bib")
writeLines(lines,"works3b.bib")
system("latex -interaction=nonstopmode main")
system2("latex -interaction=nonstopmode main")
system2("latex" "-interaction=nonstopmode main")
system2("latex", "-interaction=nonstopmode main")
setwd(paste("~/Local/Rref/",ref,sep=""))
refdir = "works4"
setwd(paste("~/Local/Rref/",refdir,sep=""))
refdir = "works4"
setwd(paste("~/Local/Rref/",refdir,sep=""))
require(bib2df)
require(stringr)
lines = readLines(paste(refdir,".bib",sep=""))
bibdf = bib2df(paste(refdir,".bib",sep=""))
refdir = "works4"
setwd(paste("~/Local/Rref/",refdir,sep=""))
require(bib2df)
require(stringr)
lines = readLines(paste(refdir,".bib",sep=""))
bibdf = bib2df(paste(refdir,".bib",sep=""))
bibdf$EXTRA = ""
for (i in 1:length(bibdf$FILE)){
frow = bibdf$FILE[i]
authors = str_split_fixed(bibdf$AUTHOR[[i]],",",2)[,1]
year =  bibdf$YEAR[i]
#  print(i)
ff = str_split(frow,";")[[1]]
for (f in ff){
if (!is.na(f) && str_detect(f,".pdf$")){
print(f)
authors = str_replace_all(authors,"[}]","")
newfile = authors[1]
if (length(authors) > 4){
newfile = paste(newfile,"_etal",sep="")
}else{
if (length(authors) > 1)
newfile = paste(newfile,authors[2],sep="_")
if (length(authors) > 2)
newfile = paste(newfile,authors[3],sep="_")
if (length(authors) > 3)
newfile = paste(newfile,authors[4],sep="_")
}
newfile = paste("https://github.com/franklinr/prodresearch/raw/master/refpdfs/",newfile,year,".pdf",sep="")
print(newfile)
file.copy(f,newfile)
bkey = bibdf$BIBTEXKEY[i]
refstart = which(str_detect(lines,bkey))
print(paste(bkey,"->",lines[refstart]))
fileline = refstart+1
while(!str_detect(lines[fileline]," file = ")){
fileline = fileline + 1
}
if (str_detect(lines[refstart],bkey) && fileline < refstart+20){
lines[fileline] = paste("  url = {",newfile,"},",sep="")
print(lines[fileline])
}
}
}
}
#https://github.com/franklinr/prodresearch/raw/master/refpdfs/Abbot-Smith_etal2017.pdf
#df2bib(bibdf,"works3a.bib")
writeLines(lines,paste(refdir,"b.bib",sep=""))
